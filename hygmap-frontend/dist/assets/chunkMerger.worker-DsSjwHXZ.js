(function(){"use strict";self.onmessage=t=>{const e=t.data;if(e.type==="merge"){const a=f(e);self.postMessage(a)}};function f(t){const e=performance.now();let a=0;t.chunks.forEach(n=>{a+=n.stars.length});const i=new Map;t.chunks.forEach(n=>{n.stars.forEach(o=>{i.has(o.id)||i.set(o.id,o)})});const u=performance.now()-e,r=Array.from(i.values());let l=0,m=r;if(r.length>t.maxStars){const n=performance.now(),{x:o,y:g,z:S}=t.cameraPosition;m=r.map(s=>{const c=s.x-o,d=s.y-g,p=s.z-S;return{star:s,distSq:c*c+d*d+p*p}}).sort((s,c)=>s.distSq-c.distSq).slice(0,t.maxStars).map(s=>s.star),l=performance.now()-n}const h=performance.now()-e;return{type:"merge-result",stars:m,stats:{inputChunks:t.chunks.length,inputStars:a,uniqueStars:r.length,outputStars:m.length,dedupeTimeMs:u,sortTimeMs:l,totalTimeMs:h}}}})();
